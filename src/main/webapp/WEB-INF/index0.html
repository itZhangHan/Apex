<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>游戏页面</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-
    scale=1,maximum-scale=1,user-scalable=no">
<script src="../js/userInfo.js"></script>
<link rel="stylesheet" href="../css/hall.css">
</head>
<body>
	<div class="centainer">
		<div class="room">
			<span id="roomID"></span> <img id="iconBtn" src="../img/iconBtn.png">
		</div>

		<div class="item_btn">
			<ul>
				<li><img id="item1" src="../img/music.png"></li>
				<li><img id="item2" src="../img/sprite7.png"></li>
				<li><img id="item3" src="../img/sprite10.png"></li>
			</ul>
		</div>

		<div class="game_go">
			<!-- 开始游戏 -->
			<img id="game_go" src="../img/startBtn.png">
		</div>

		<div class="player_btn">
			<ul>
				<li id="player1"><img id="headImg1" src="../img/sprite5.png"></li>
				<li id="player2"><img id="headImg2"></li>
			</ul>
			<ul>
				<li id="player3"><img src=""></li>
				<li id="player4"><img src="../img/sprite5.png"></li>
			</ul>
		</div>
		<div class="chatRoom" id="chatRoom"></div>
		<div class="ele">
			<input id="sendTxt_0" type="text" />
			<button id="sendBtn_0">
				<img src="../img/sendBtn.png">
			</button>
		</div>

		<div class="icon-player">
			<ul>
				<li id="icon1"><span id="orPrepare" style="color: gold">未入座</span><img id="img1" src="../img/icon5.png"></li>
				<li id="icon2"><img id="img2" src="../img/icon5.png"></li>
				<li id="icon3"><img id="img3" src="../img/icon6.png"></li>
				<li id="icon4"><img id="img4" src="../img/icon7.png"></li>
			</ul>

		</div>

	</div>
	<script type="text/javascript">
		// var div_2 = document.getElementById("chatRoom");
		var div_2;
		var count = 0;
		var roomID = document.getElementById("roomID").innerHTML;
	//	var websocket = new WebSocket("ws://thdd.apexgame.cn/tetris/websocket1");
		function showMessage(str, type) {
			var div_3 = document.createElement("div");
			div_3.style.fontSize = "20px";
			div_3.style.paddingRight = "20px";
			div_3.style.wordBreak = "break-all"
			div_3.style.marginTop = "10px";
			var ss = 7;
			div_3.innerHTML = "<img src='../img/icon4.png' style='width: 30px;height:30px;display: block;margin-bottom: 5px'>"
					+ "&nbsp;&nbsp;&nbsp;&nbsp;" + str + '<br />';
			div_2.appendChild(div_3)

			div_2.scrollTop = div_2.scrollHeight;
		}
		function showImgURL(headimgurl) {
			var headURL = document.getElementById("headImg1");

			headURL.src = headimgurl
		}
		websocket.onOpen = function() {
			console.log("websocket open")

			if (roomID) {
				websocket.send(roomID)
			}

		}
		document.getElementById("sendBtn_0").onclick = function() {
			var txt = document.getElementById("sendTxt_0").value;
			div_2 = document.getElementById("chatRoom");
			div_2.style.overflowY = "scroll";//auto    scroll
			var num = Math.random() * 10;
			document.getElementById("sendTxt_0").value = "";
			if (txt) {
				var mes = {};
				mes.type = "message"
				mes.roomId = roomId;
				mes.toUserName = "1"
				mes.fromUserName = "2"
				mes.msgStr = txt
				mes.userStatus = userStatus
				mes.roomState = roomState
				mes.position = "1"
				mes.headimgurl = img
				websocket.send(JSON.stringify(mes))
			}
			count++;
		}
		websocket.onClose = function() {
			console.log("websocket close")
		}
		websocket.onmessage = function(e) {
			var jsonObj = eval("(" + e.data + ")");
			console.log(jsonObj)
			var b = JSON.parse(jsonObj);

			showImgURL(b.headimgurl)
			showMessage(b.msgStr, b.type);

		}
		var head1 = document.getElementById("headImg1")
		//head1.src = img
		var onlooker1 = document.getElementById("img1");
		onlooker1.src = img
		head1.onclick = function() {
			var upDown = {};
			upDown.type = "upDown"
			upDown.roomId = roomId;
			upDown.toUserName = "1"
			upDown.fromUserName = "2"
			upDown.msgStr = ""
			upDown.userStatus = userStatus
			upDown.roomState = roomState
			upDown.position = "1"
			upDown.headimgurl = img
			websocket.send(JSON.stringify(upDown))
		}
        var headImg2 = document.getElementById("headImg2")

        var head2 = document.getElementById("player2");
        var orPrepare = document.getElementById("orPrepare");

        var f = false;
        head2.onclick = function () {
            console.log("headImg2.src============"+head2.src)
            if(f == false){
                headImg2.src = "../img/icon5.png"
                orPrepare.innerHTML = "已准备"
                orPrepare.style.color = "darkgreen";
                f = true;

                   var upDown = {};
                 upDown.type = "upDown"
                 upDown.roomId = roomId;
                 upDown.toUserName = "1"
                 upDown.fromUserName = "2"
                 upDown.msgStr = ""
                 upDown.userStatus = userStatus
                 upDown.roomState = roomState
                 upDown.position = "1"
                 upDown.headimgurl = img
                 websocket.send(JSON.stringify(upDown))
            }else{
                headImg2.src = ""
                orPrepare.innerHTML = "已离开"
                orPrepare.style.color = "orangered"
                f = false

                   var upDown = {};
                 upDown.type = "upDown"
                 upDown.roomId = roomId;
                 upDown.toUserName = "1"
                 upDown.fromUserName = "2"
                 upDown.msgStr = ""
                 upDown.userStatus = userStatus
                 upDown.roomState = roomState
                 upDown.position = "1"
                 upDown.headimgurl = img
                 websocket.send(JSON.stringify(upDown))

            }


        }
	</script>
	<script src="../js/hall.js"></script>

</body>
</html>