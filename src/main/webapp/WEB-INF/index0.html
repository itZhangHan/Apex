<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>游戏页面</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-
    scale=1,maximum-scale=1,user-scalable=no">
<script src="../js/webSocket.js"></script>
<script src="../js/userInfo.js"></script>
<script src="../js/vue.js"></script>
<script src="../js/vue.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.2.2/vue.min.js"></script>
<link rel="stylesheet" href="../css/hall.css">
</head>
<body onload="usmessage()">

	<div class="centainer">
		<div class="room">
			<span id="roomID"></span> <img id="iconBtn" src="../img/iconBtn.png">
		</div>

		<div class="item_btn">
			<ul>
				<li><img id="item1" src="../img/music.png"></li>
				<li><img id="item2" src="../img/sprite7.png"></li>
				<li><img id="item3" src="../img/sprite10.png"></li>
			</ul>
		</div>

		<div class="game_go">
			<!-- 开始游戏 -->
			<img id="game_go"
				onclick="location.href='http://thdd.apexgame.cn/tetris/skip/indexsend'"
				src="../img/startBtn.png">
		</div>
		<div class="player_btn">
			<ul>
				<li id="player1" value=""><img id="headImg1" src=""></li>
				<li id="player2" value=""><img id="headImg2" src=""></li>
			</ul>
			<ul>
				<li id="player3" value=""><img id="headImg3" src=""></li>
				<li id="player4" value=""><img id="headImg4" src=""></li>
			</ul>
		</div>

		<div class="icon-player">
			<ul>
				<li id="icon1"><span id="orPrepare" style="color: gold"></span><img
					id="img1" src=""></li>
				<li id="icon2"><span id="orPrepare2" style="color: gold"></span><img
					id="img2" src=""></li>
				<li id="icon3"><span id="orPrepare3" style="color: gold"></span><img
					id="img3"></li>
				<li id="icon4"><span id="orPrepare4" style="color: gold"></span><img
					id="img4"></li>
				<li id="icon5"><span id="orPrepare5" style="color: gold"></span><img
					id="img5"></li>
				<li id="icon6"><span id="orPrepare6" style="color: gold"></span><img
					id="img6"></li>
				<li id="icon7"><span id="orPrepare7" style="color: gold"></span><img
					id="img7"></li>
				<li id="icon8"><span id="orPrepare8" style="color: gold"></span><img
					id="img8"></li>
			</ul>
		</div>
		<div class="chatRoom" id="chatRoom"></div>
		<div class="ele">
			<input id="sendTxt_0" type="text" />
			<button id="sendBtn_0">
				<img src="../img/sendBtn.png">
			</button>
		</div>

	</div>
	<script type="text/javascript">
		//旁观者
		var headUrl0 = document.getElementById("img1");
		var headUrl1 = document.getElementById("img2");
		var headUrl2 = document.getElementById("img3");
		var headUrl3 = document.getElementById("img4");
		var headUrl4 = document.getElementById("img5");
		var headUrl5 = document.getElementById("img6");
		var headUrl6 = document.getElementById("img7");
		var headUrl7 = document.getElementById("img8");

		//玩家
		var head2 = document.getElementById("player2");
		var head3 = document.getElementById("player3");
		var head4 = document.getElementById("player4");

		function usmessage() {
			var userMessage = {};
			userMessage.type = "usmesage"
			userMessage.roomId = roomId;
			userMessage.toUserName = "";
			userMessage.fromUserName = "";
			userMessage.msgStr = "";
			userMessage.userStatus = userStatus;
			userMessage.roomState = roomState;
			userMessage.position = "1";
			userMessage.headimgurl = img;
			userMessage.nicakname = nicakname;
			userMessage.sex = sex;
			userMessage.city = city;
			userMessage.userId = userId;
			alert("我是:" + nicakname);
			websocket.send(JSON.stringify(userMessage));
		}
		//聊天通信模块
		document.getElementById("sendBtn_0").onclick = function() {
			var txt = document.getElementById("sendTxt_0").value;
			div_2 = document.getElementById("chatRoom");
			div_2.style.overflowY = "scroll";//auto    scroll
			document.getElementById("sendTxt_0").value = "";
			var mes = {};
			mes.type = "message";
			mes.msgStr = txt;
			mes.roomId = roomId;
			mes.toUserName = ""
			mes.fromUserName = "";
			mes.userStatus = userStatus;
			mes.roomState = roomState;
			mes.roomName = roomName;
			mes.position = ""
			mes.headimgurl = img;
			mes.nicakname = nicakname;
			mes.city = city;
			mes.sex = sex;
			mes.userId = userId;
			websocket.send(JSON.stringify(mes));
		}
		//接收起立type 展示数据
		function showUpmessage(b) {
			if(b.position=='2'){
				head2.src = '';
				orPrepare2.innerHTML = ""
			}else if(b.position=='3'){
				head3.src = '';
				orPrepare3.innerHTML = ""
			}else if(b.position=='4'){
				head4.src = '';
				orPrepare4.innerHTML = ""
			}
		}
		//接收坐下type 展示数据
		function showDownmessage(b) {
			if(b.position=='2'){
				head2.src = b.headimgurl;
				orPrepare2.innerHTML = "已准备"
			}else if(b.position=='3'){
				head3.src = b.headimgurl;
				orPrepare3.innerHTML = "已准备"
			}else if(b.position=='4'){
				head4.src = b.headimgurl;
				orPrepare4.innerHTML = "已准备"
			}
		}
		//接收游戏类型 设置游戏开始
		function actionGame(b) {

		}
		//显示分数信息
		function showScore(b) {

		}

		//显示旁观者信息
		function showUserList(listUsers) {
			alert("返回玩家 列表:"+listUsers);
			for (var i = 0; i < listUsers.length; i++) {
				//旁观者
				(headUrl + i).src = listUsers[i].userportrait;
				(head + i).value = listUsers[i].userid;
				//(head + i).src = listUsers[i].userportrait;
			}
		}
		//接收房间所有信息，展示用户信息
		function showMessage(str) {
			var div_3 = document.createElement("div");
			div_3.style.fontSize = "20px";
			div_3.style.paddingRight = "20px";
			div_3.style.wordBreak = "break-all"
			div_3.style.marginTop = "10px";
			var ss = 7;
			div_3.innerHTML = "<img src='../img/icon4.png' style='width: 30px;height:30px;display: block;margin-bottom: 5px'>"
					+ "&nbsp;&nbsp;&nbsp;&nbsp;" + str + '<br />';
			div_2.appendChild(div_3)

			div_2.scrollTop = div_2.scrollHeight;
		}
		websocket.onmessage = function(e) {
			var jsonObj = eval("(" + e.data + ")");
			console.log(jsonObj)
			var b = JSON.parse(jsonObj);
			alert("接收到服务端返回数据:" + b);
			if (b.type == 'message') {
				//展示发送消息数据
				showMessage(b.msgStr, b.type);
			}
			//优先级 *****
			if (b.type == 'usmesage') {
				//显示旁观者信息
				showUserList(b.listUsers);
			}
			if (b.type == 'up') {
				//展示起立信息
				showUpmessage(b);
			}
			if (b.type == 'down') {
				//展示坐下信息
				showDownmessage(b);
			}
			if (b.type == 'roomStatus') {
				//展示游戏开始数据
				actionGame(b);
			}
			if (b.type == 'score') {
				//展示分数信息
				showScore(b);
			}
		}

		//点击头像信息触发事件
		//设置房主头像默认准备 以及不给于除点击取余权限
		var div_2;
		var headImg1 = document.getElementById("headImg1");
		var orPrepare = document.getElementById("orPrepare");
		headImg1.src = img;

		document.getElementById("img1").src = img;

		headImg1.style.width = "60%"
		headImg1.style.marginTop = "19%"
		orPrepare.innerHTML = "已准备"
		orPrepare.style.color = "darkgreen";

		var headImg2 = document.getElementById("headImg2");
		var head2 = document.getElementById("player2");
		var orPrepare2 = document.getElementById("orPrepare2");
		var f2 = false;
		//点击头像二时候触发事件
		head2.onclick = function() {
			console.log("headImg2.src============" + userId)
			var userId = head2.value;
			if (userId == '') {
				alert("可以坐下，发送请求坐下消息");
				f2 = true;
				var upDown = {};
				upDown.type = "Down"
				upDown.roomId = roomId;
				upDown.toUserName = "2";
				upDown.fromUserName = " ";
				upDown.msgStr = ""
				upDown.userStatus = userStatus;
				upDown.roomState = roomState
				upDown.position = "2"
				upDown.headimgurl = img
				upDown.nicakname = nicakname;
				upDown.sex = sex;
				upDown.city = city;
				upDown.userId = userId;
				websocket.send(JSON.stringify(upDown));

			} else {
				//位置有人
				if (userId == user.userId) {
					var upDown = {};
					upDown.type = "up"
					upDown.roomId = roomId;
					upDown.toUserName = "2";
					upDown.fromUserName = " ";
					upDown.msgStr = ""
					upDown.userStatus = userStatus;
					upDown.roomState = roomState
					upDown.position = "2"
					upDown.headimgurl = img
					upDown.nicakname = nicakname;
					upDown.sex = sex;
					upDown.city = city;
					upDown.userId = userId;
					websocket.send(JSON.stringify(upDown));

				} else {
					var upDown = {};
					upDown.type = "Down"
					upDown.roomId = roomId;
					upDown.toUserName = "2";
					upDown.fromUserName = " ";
					upDown.msgStr = ""
					upDown.userStatus = userStatus;
					upDown.roomState = roomState
					upDown.position = "2"
					upDown.headimgurl = img
					upDown.nicakname = nicakname;
					upDown.sex = sex;
					upDown.city = city;
					upDown.userId = userId;
					websocket.send(JSON.stringify(upDown));

				}

			}
		}

		var headImg3 = document.getElementById("headImg3");
		var head3 = document.getElementById("player3");
		var orPrepare3 = document.getElementById("orPrepare3");
		var f3 = false;
		//       document.getElementById("img3").src = img
		head3.onclick = function() {
			var userId = head3.value;
			console.log("headImg3.src============" + headImg3.src)
			if (userId == '') {
				alert("可以坐下");
				f3 = true;
				var upDown = {};
				upDown.type = "Down"
				upDown.roomId = roomId;
				upDown.toUserName = "";
				upDown.fromUserName = " ";
				upDown.msgStr = ""
				upDown.userStatus = userStatus;
				upDown.roomState = roomState
				upDown.position = "3"
				upDown.headimgurl = img
				upDown.nicakname = nicakname;
				upDown.sex = sex;
				upDown.city = city;
				upDown.userId = userId;
				websocket.send(JSON.stringify(upDown));

			} else {
				if (userId == user.userId) {
					var upDown = {};
					upDown.type = "up"
					upDown.roomId = roomId;
					upDown.toUserName = "2";
					upDown.fromUserName = " ";
					upDown.msgStr = ""
					upDown.userStatus = userStatus;
					upDown.roomState = roomState
					upDown.position = "3"
					upDown.headimgurl = img
					upDown.nicakname = nicakname;
					upDown.sex = sex;
					upDown.city = city;
					upDown.userId = userId;
					websocket.send(JSON.stringify(upDown));

				} else {
					alert("此位置已经有人了!");
				}

			}
		}

		var headImg4 = document.getElementById("headImg4")
		var head4 = document.getElementById("player4");
		var orPrepare4 = document.getElementById("orPrepare4");
		var f4 = false;
		head4.onclick = function() {
			var userId = head4.value;
			console.log("headImg4.src============" + headImg4.src)
			if (userId == '') {
				alert("可以坐下");
				f2 = true;
				var upDown = {};
				upDown.type = "Down"
				upDown.roomId = roomId;
				upDown.toUserName = "2";
				upDown.fromUserName = " ";
				upDown.msgStr = ""
				upDown.userStatus = userStatus;
				upDown.roomState = roomState
				upDown.position = "4"
				upDown.headimgurl = img
				websocket.send(JSON.stringify(upDown));
			} else {
				if (userId == user.userId) {
					var upDown = {};
					upDown.type = "up"
					upDown.roomId = roomId;
					upDown.toUserName = "2";
					upDown.fromUserName = " ";
					upDown.msgStr = ""
					upDown.userStatus = userStatus;
					upDown.roomState = roomState
					upDown.position = "2"
					upDown.headimgurl = img
					upDown.nicakname = nicakname;
					upDown.sex = sex;
					upDown.city = city;
					upDown.userId = userId;
					websocket.send(JSON.stringify(upDown));

				} else {
					alert("此位置已经有人了！");
				}

			}
		}
	</script>
	<script src="../js/hall.js"></script>
</body>
</html>